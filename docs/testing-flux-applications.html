<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Flux | Application Architecture for Building User Interfaces</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Flux | Application Architecture for Building User Interfaces"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/flux/index.html"><meta property="og:description" content="Application Architecture for Building User Interfaces"><link rel="stylesheet" href="/flux/css/flux.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/flux/"><img class="nav-logo" src="/flux/img/flux_logo.svg" width="50" height="50">Flux</a><ul class="nav-site"><li><a href="/flux/docs/overview.html#content" class="active">docs</a></li><li><a href="/flux/support.html" class="">support</a></li><li><a href="http://github.com/facebook/flux" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/overview.html#content">Overview</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/todo-list.html#content">Tutorial – Todo List</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/chat.html#content">Tutorial – Chat</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/actions-and-the-dispatcher.html#content">Actions and the Dispatcher</a></li><li><a style="margin-left:0;" class="active" href="/flux/docs/testing-flux-applications.html#content">Testing Flux Applications</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/dispatcher.html#content">Dispatcher</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/flux-utils.html#content">Flux Utils</a></li></ul></div><div class="nav-docs-section"><h3>Community Resources</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/videos.html#content">Videos</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/examples-and-tools.html#content">Examples and Tools</a></li></ul></div><div class="nav-docs-section"><h3>Complementary</h3><ul><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/react/">React – UI Library</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/immutable-js/">ImmutableJS – Immutable Data</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/jest/">Jest – Unit Testing</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Testing Flux Applications</h1><div><p>This guide originally appeared as a <a href="http://facebook.github.io/react/blog/2014/09/24/testing-flux-applications.html" target="_blank">post</a> on the <a href="http://facebook.github.io/react/blog/" target="_blank">React blog</a>, and has been edited and updated for inclusion here.</p><p>In previous articles, we&#x27;ve shown the <a href="http://facebook.github.io/flux/docs/overview.html" target="_blank">basic structure and data flow</a>, more closely examined the <a href="http://facebook.github.io/flux/docs/actions-and-the-dispatcher.html" target="_blank">dispatcher and action creators</a>, and shown how to put it all together with a <a href="http://facebook.github.io/flux/docs/todo-list.html" target="_blank">tutorial</a>. Now let&#x27;s look at how to do formal unit testing of Flux applications with <a href="http://facebook.github.io/jest/" target="_blank">Jest</a>, Facebook&#x27;s auto-mocking testing framework.</p><h2><a class="anchor" name="testing-with-jest"></a>Testing with Jest <a class="hash-link" href="#testing-with-jest">#</a></h2><p>For a unit test to operate on a truly isolated <em>unit</em> of the application, we need to mock every module except the one we are testing. Jest makes the mocking of other parts of a Flux application trivial. To illustrate testing with Jest, we&#x27;ll return to our <a href="https://github.com/facebook/flux/tree/master/examples/flux-todomvc" target="_blank">example TodoMVC application</a>.</p><p>The first steps toward working with Jest are as follows:</p><ol><li>Get the module dependencies for the application installed by running <code>npm install</code>.</li><li>Create a directory <code>__tests__/</code> with a test file, in this case TodoStore-test.js</li><li>Run <code>npm install jest-cli -—save-dev</code></li><li>Add the following to your package.json</li></ol><div class="prism language-javascript"><span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></div><p>Now you&#x27;re ready to run your tests from the command line with <code>npm test</code>.</p><p>By default, all modules are mocked, so the only boilerplate we need in TodoStore-test.js is a declarative call to Jest&#x27;s <code>dontMock()</code> method.</p><div class="prism language-javascript">jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;TodoStore&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>This tells Jest to let TodoStore be a real object with real, live methods. Jest will mock all other objects involved with the test.</p><h2><a class="anchor" name="testing-stores"></a>Testing Stores <a class="hash-link" href="#testing-stores">#</a></h2><p>At Facebook, Flux stores often receive a great deal of formal unit test coverage, as this is where the application state and logic lives. Stores are arguably the most important place in a Flux application to provide coverage, but at first glance, it&#x27;s not entirely obvious how to test them.</p><p>By design, stores can&#x27;t be modified from the outside. They have no setters. The only way new data can enter a store is through the callback it registers with the dispatcher.</p><p>We therefore need to simulate the Flux data flow with this <em>one weird trick</em>.</p><div class="prism language-javascript"><span class="token keyword">var</span> mockRegister <span class="token operator">=</span> MyDispatcher<span class="token punctuation">.</span>register<span class="token punctuation">;</span>
<span class="token keyword">var</span> mockRegisterInfo <span class="token operator">=</span> mockRegister<span class="token punctuation">.</span>mock<span class="token punctuation">;</span>
<span class="token keyword">var</span> callsToRegister <span class="token operator">=</span> mockRegisterInfo<span class="token punctuation">.</span>calls<span class="token punctuation">;</span>
<span class="token keyword">var</span> firstCall <span class="token operator">=</span> callsToRegister<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> firstArgument <span class="token operator">=</span> firstCall<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> callback <span class="token operator">=</span> firstArgument<span class="token punctuation">;</span></div><p>We now have the store&#x27;s registered callback, the sole mechanism by which data can enter the store.</p><p>For folks new to Jest, or mocks in general, it might not be entirely obvious what is happening in that code block, so let&#x27;s look at each part of it a bit more closely. We start out by looking at the <code>register()</code> method of our application&#x27;s dispatcher — the method that the store uses to register its callback with the dispatcher. The dispatcher has been thoroughly mocked automatically by Jest, so we can get a reference to the mocked version of the <code>register()</code> method just as we would normally refer to that method in our production code. But we can get additional information about that method with the <code>mock</code> <em>property</em> of that method. We don&#x27;t often think of methods having properties, but in Jest, this idea is vital. Every method of a mocked object has this property, and it allows us to examine how the method is being called during the test. A chronologically ordered list of calls to <code>register()</code> is available with the <code>calls</code> property of <code>mock</code>, and each of these calls has a list of the arguments that were used in each method call.</p><p>So in this code, we are really saying, &quot;Give me a reference to the first argument of the first call to MyDispatcher&#x27;s <code>register()</code> method.&quot; That first argument is the store&#x27;s callback, so now we have all we need to start testing.  But first, we can save ourselves some semicolons and roll all of this into a single line:</p><div class="prism language-javascript">callback <span class="token operator">=</span> MyDispatcher<span class="token punctuation">.</span>register<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><p>We can invoke that callback whenever we like, independent of our application&#x27;s dispatcher or action creators. We will, in fact, fake the behavior of the dispatcher and action creators by invoking the callback with an action that we&#x27;ll create directly in our test.</p><div class="prism language-javascript"><span class="token keyword">var</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
  actionType<span class="token punctuation">:</span> TodoConstants<span class="token punctuation">.</span>TODO_CREATE<span class="token punctuation">,</span>
  text<span class="token punctuation">:</span> <span class="token string">&#x27;foo&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">callback<span class="token punctuation">(</span></span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> all <span class="token operator">=</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys<span class="token punctuation">(</span></span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect<span class="token punctuation">(</span></span>all<span class="token punctuation">[</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual<span class="token punctuation">(</span></span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><h2><a class="anchor" name="putting-it-all-together"></a>Putting it All Together <a class="hash-link" href="#putting-it-all-together">#</a></h2><p>The example Flux TodoMVC application has been updated with an example test for the TodoStore, but let&#x27;s look at an abbreviated version of the entire test. The most important things to notice in this test are how we keep a reference to the store&#x27;s registered callback in the closure of the test, and how we recreate the store before every test so that we clear the state of the store entirely.</p><div class="prism language-javascript">jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;../TodoStore&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">dontMock<span class="token punctuation">(</span></span><span class="token string">&#x27;object-assign&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe<span class="token punctuation">(</span></span><span class="token string">&#x27;TodoStore&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> TodoConstants <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../../constants/TodoConstants&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> AppDispatcher<span class="token punctuation">;</span>
  <span class="token keyword">var</span> TodoStore<span class="token punctuation">;</span>
  <span class="token keyword">var</span> callback<span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true"> // mock actions 
</span>  <span class="token keyword">var</span> actionTodoCreate <span class="token operator">=</span> <span class="token punctuation">{</span>
    actionType<span class="token punctuation">:</span> TodoConstants<span class="token punctuation">.</span>TODO_CREATE<span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">&#x27;foo&#x27;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> actionTodoDestroy <span class="token operator">=</span> <span class="token punctuation">{</span>
    actionType<span class="token punctuation">:</span> TodoConstants<span class="token punctuation">.</span>TODO_DESTROY<span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token string">&#x27;replace me in test&#x27;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    AppDispatcher <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../../dispatcher/AppDispatcher&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    TodoStore <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../TodoStore&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback <span class="token operator">=</span> AppDispatcher<span class="token punctuation">.</span>register<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;registers a callback with the dispatcher&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>AppDispatcher<span class="token punctuation">.</span>register<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;initializes with no to-do items&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> all <span class="token operator">=</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>all<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual<span class="token punctuation">(</span></span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;creates a to-do item&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback<span class="token punctuation">(</span></span>actionTodoCreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> all <span class="token operator">=</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys<span class="token punctuation">(</span></span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>all<span class="token punctuation">[</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual<span class="token punctuation">(</span></span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;destroys a to-do item&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback<span class="token punctuation">(</span></span>actionTodoCreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> all <span class="token operator">=</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys<span class="token punctuation">(</span></span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    actionTodoDestroy<span class="token punctuation">.</span>id <span class="token operator">=</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">callback<span class="token punctuation">(</span></span>actionTodoDestroy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect<span class="token punctuation">(</span></span>all<span class="token punctuation">[</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>You can take a look at all this code in the <a href="https://github.com/facebook/flux/tree/master/examples/flux-todomvc/js/stores/__tests__/TodoStore-test.js" target="_blank">TodoStore&#x27;s tests on GitHub</a> as well. </p><h2><a class="anchor" name="mocking-data-derived-from-other-stores"></a>Mocking Data Derived from Other Stores <a class="hash-link" href="#mocking-data-derived-from-other-stores">#</a></h2><p>Sometimes our stores rely on data from other stores. Because all of our modules are mocked, we&#x27;ll need to simulate the data that comes from the other store.  We can do this by retrieving the mock function and adding a custom return value to it.</p><div class="prism language-javascript"><span class="token keyword">var</span> MyOtherStore <span class="token operator">=</span> <span class="token function">require<span class="token punctuation">(</span></span><span class="token string">&#x27;../MyOtherStore&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MyOtherStore<span class="token punctuation">.</span>getState<span class="token punctuation">.</span><span class="token function">mockReturnValue<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
  <span class="token string">&#x27;123&#x27;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&#x27;123&#x27;</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">&#x27;foo&#x27;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&#x27;456&#x27;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&#x27;456&#x27;</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> <span class="token string">&#x27;bar&#x27;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>Now we have a collection of objects that will come back from MyOtherStore whenever we call MyOtherStore.getState() in our tests.  Any application state can be simulated with a combination of these custom return values and the previously shown technique of working with the store&#x27;s registered callback.</p><p>A brief example of this technique is up on GitHub within the Flux Chat example&#x27;s <a href="https://github.com/facebook/flux/tree/master/examples/flux-chat/js/stores/__tests__/UnreadThreadStore-test.js" target="_blank">UnreadThreadStore-test.js</a>.</p><p>For more information about the <code>mock</code> property of mocked methods or Jest&#x27;s ability to provide custom mock values, see Jest&#x27;s documentation on <a href="http://facebook.github.io/jest/docs/mock-functions.html" target="_blank">mock functions</a>.</p><h2><a class="anchor" name="moving-logic-from-react-to-stores"></a>Moving Logic from React to Stores <a class="hash-link" href="#moving-logic-from-react-to-stores">#</a></h2><p>What often starts as a little piece of seemingly benign logic in our React components often presents a problem while creating unit tests. We want to be able to write tests that read like a specification for our application&#x27;s behavior, and when application logic slips into our view layer, this becomes more difficult.</p><p>For example, when a user has marked each of their to-do items as complete, the TodoMVC specification dictates that we should also change the status of the &quot;Mark all as complete&quot; checkbox automatically. To create that logic, we might be tempted to write code like this in our MainSection&#x27;s <code>render()</code> method:</p><div class="prism language-javascript"><span class="token keyword">var</span> allTodos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>allTodos<span class="token punctuation">;</span>
<span class="token keyword">var</span> allChecked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> allTodos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allTodos<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    allChecked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">return</span> <span class="token punctuation">(</span>
  &lt;section id<span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span>
  &lt;input
    id<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span>
    type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
    checked<span class="token operator">=</span><span class="token punctuation">{</span>allChecked <span class="token operator">?</span> <span class="token string">&#x27;checked&#x27;</span> <span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  &lt;<span class="token operator">/</span>section<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>While this seems like an easy, normal thing to do, this is an example of application logic slipping into the views, and it can&#x27;t be described in our spec-style TodoStore test. Let&#x27;s take that logic and move it to the store. First, we&#x27;ll create a public method on the store that will encapsulate that logic:</p><div class="prism language-javascript">areAllComplete<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> id <span class="token keyword">in</span> _todos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_todos<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></div><p>Now we have the application logic where it belongs, and we can write the following test:</p><div class="prism language-javascript"><span class="token function">it<span class="token punctuation">(</span></span><span class="token string">&#x27;determines whether all to-do items are complete&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i &lt; <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback<span class="token punctuation">(</span></span>mockTodoCreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect<span class="token punctuation">(</span></span>TodoStore<span class="token punctuation">.</span><span class="token function">areAllComplete<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> all <span class="token operator">=</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
      source<span class="token punctuation">:</span> <span class="token string">&#x27;VIEW_ACTION&#x27;</span><span class="token punctuation">,</span>
      action<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        actionType<span class="token punctuation">:</span> TodoConstants<span class="token punctuation">.</span>TODO_COMPLETE<span class="token punctuation">,</span>
        id<span class="token punctuation">:</span> key
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">expect<span class="token punctuation">(</span></span>TodoStore<span class="token punctuation">.</span><span class="token function">areAllComplete<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">callback<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
    source<span class="token punctuation">:</span> <span class="token string">&#x27;VIEW_ACTION&#x27;</span><span class="token punctuation">,</span>
    action<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      actionType<span class="token punctuation">:</span> TodoConstants<span class="token punctuation">.</span>TODO_UNDO_COMPLETE<span class="token punctuation">,</span>
      id<span class="token punctuation">:</span> key
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect<span class="token punctuation">(</span></span>TodoStore<span class="token punctuation">.</span><span class="token function">areAllComplete<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe<span class="token punctuation">(</span></span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>Finally, we revise our view layer. We&#x27;ll call for that data in the controller-view, TodoApp.js, and pass it down to the MainSection component.</p><div class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">getTodoState<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    allTodos<span class="token punctuation">:</span> TodoStore<span class="token punctuation">.</span><span class="token function">getAll<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    areAllComplete<span class="token punctuation">:</span> TodoStore<span class="token punctuation">.</span><span class="token function">areAllComplete<span class="token punctuation">(</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> TodoApp <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token comment" spellcheck="true">/**
   * @return {object}
   */</span>
  render<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      &lt;MainSection
        allTodos<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>allTodos<span class="token punctuation">}</span>
        areAllComplete<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>areAllComplete<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment" spellcheck="true">/**
   * Event handler for &#x27;change&#x27; events coming from the TodoStore
   */</span>
  _onChange<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState<span class="token punctuation">(</span></span><span class="token function">getTodoState<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>And then we&#x27;ll utilize that property for the rendering of the checkbox.</p><div class="prism language-javascript">render<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    &lt;section id<span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span>
    &lt;input
      id<span class="token operator">=</span><span class="token string">&quot;toggle-all&quot;</span>
      type<span class="token operator">=</span><span class="token string">&quot;checkbox&quot;</span>
      checked<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>areAllComplete <span class="token operator">?</span> <span class="token string">&#x27;checked&#x27;</span> <span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    &lt;<span class="token operator">/</span>section<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></div><p>To learn how to test React components themselves, check out the <a href="http://facebook.github.io/jest/docs/tutorial-react.html" target="_blank">Jest tutorial for React</a> and the <a href="http://facebook.github.io/react/docs/test-utils.html" target="_blank">ReactTestUtils documentation</a>.</p><h2><a class="anchor" name="further-reading"></a>Further Reading <a class="hash-link" href="#further-reading">#</a></h2><ul><li><a href="http://martinfowler.com/articles/mocksArentStubs.html" target="_blank">Mocks Aren&#x27;t Stubs</a> by Martin Fowler</li><li><a href="http://facebook.github.io/jest/docs/api.html" target="_blank">Jest API Reference</a></li></ul></div><div class="docs-prevnext"><a class="docs-next" href="dispatcher.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2014-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>