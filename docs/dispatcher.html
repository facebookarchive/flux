<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Flux | Application Architecture for Building User Interfaces</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Flux | Application Architecture for Building User Interfaces"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/flux/index.html"><meta property="og:description" content="Application Architecture for Building User Interfaces"><link rel="stylesheet" href="/flux/css/flux.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/flux/"><img class="nav-logo" src="/flux/img/flux_logo.svg" width="50" height="50">Flux</a><ul class="nav-site"><li><a href="/flux/docs/overview.html#content" class="active">docs</a></li><li><a href="/flux/support.html" class="">support</a></li><li><a href="http://github.com/facebook/flux" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/overview.html#content">Overview</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/todo-list.html#content">Tutorial – Todo List</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/chat.html#content">Tutorial – Chat</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/actions-and-the-dispatcher.html#content">Actions and the Dispatcher</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/testing-flux-applications.html#content">Testing Flux Applications</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="active" href="/flux/docs/dispatcher.html#content">Dispatcher</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/flux-utils.html#content">Flux Utils</a></li></ul></div><div class="nav-docs-section"><h3>Community Resources</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/videos.html#content">Videos</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/examples-and-tools.html#content">Examples and Tools</a></li></ul></div><div class="nav-docs-section"><h3>Complementary</h3><ul><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/react/">React – UI Library</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/immutable-js/">ImmutableJS – Immutable Data</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/jest/">Jest – Unit Testing</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Dispatcher</h1><div><p>Dispatcher is used to broadcast payloads to registered callbacks. This is
different from generic pub-sub systems in two ways:</p><ul><li>Callbacks are not subscribed to particular events. Every payload is
   dispatched to every registered callback.</li><li>Callbacks can be deferred in whole or part until other callbacks have
   been executed.</li></ul><p>Check out <a href="https://github.com/facebook/flux/blob/master/src/Dispatcher.js" target="_blank">Dispatcher.js</a> for the source code.</p><h2><a class="anchor" name="api"></a>API <a class="hash-link" href="#api">#</a></h2><ul><li><p><strong>register(function callback): string</strong>
Registers a callback to be invoked with every dispatched payload. Returns a token that can be used with <code>waitFor()</code>.</p></li><li><p><strong>unregister(string id): void</strong>
Removes a callback based on its token.</p></li><li><p><strong>waitFor(array&lt;string&gt; ids): void</strong>
Waits for the callbacks specified to be invoked before continuing execution of the current callback. This method should only be used by a callback in response to a dispatched payload.</p></li><li><p><strong>dispatch(object payload): void</strong> Dispatches a payload to all registered callbacks.</p></li><li><p><strong>isDispatching(): boolean</strong> Is this Dispatcher currently dispatching.</p></li></ul><h2><a class="anchor" name="example"></a>Example <a class="hash-link" href="#example">#</a></h2><p>For example, consider this hypothetical flight destination form, which
selects a default city when a country is selected:</p><div class="prism language-javascript"><span class="token keyword">var</span> flightDispatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// Keeps track of which country is selected
</span><span class="token keyword">var</span> CountryStore <span class="token operator">=</span> <span class="token punctuation">{</span>country<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// Keeps track of which city is selected
</span><span class="token keyword">var</span> CityStore <span class="token operator">=</span> <span class="token punctuation">{</span>city<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">
// Keeps track of the base flight price of the selected city
</span><span class="token keyword">var</span> FlightPriceStore <span class="token operator">=</span> <span class="token punctuation">{</span>price<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">;</span></div><p>When a user changes the selected city, we dispatch the payload:</p><div class="prism language-javascript">flightDispatcher<span class="token punctuation">.</span><span class="token function">dispatch<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
  actionType<span class="token punctuation">:</span> <span class="token string">&#x27;city-update&#x27;</span><span class="token punctuation">,</span>
  selectedCity<span class="token punctuation">:</span> <span class="token string">&#x27;paris&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>This payload is digested by <code>CityStore</code>:</p><div class="prism language-javascript">flightDispatcher<span class="token punctuation">.</span><span class="token function">register<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>actionType <span class="token operator">===</span> <span class="token string">&#x27;city-update&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CityStore<span class="token punctuation">.</span>city <span class="token operator">=</span> payload<span class="token punctuation">.</span>selectedCity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>When the user selects a country, we dispatch the payload:</p><div class="prism language-javascript">flightDispatcher<span class="token punctuation">.</span><span class="token function">dispatch<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
  actionType<span class="token punctuation">:</span> <span class="token string">&#x27;country-update&#x27;</span><span class="token punctuation">,</span>
  selectedCountry<span class="token punctuation">:</span> <span class="token string">&#x27;australia&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>This payload is digested by both stores:</p><div class="prism language-javascript"> CountryStore<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> flightDispatcher<span class="token punctuation">.</span><span class="token function">register<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>actionType <span class="token operator">===</span> <span class="token string">&#x27;country-update&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CountryStore<span class="token punctuation">.</span>country <span class="token operator">=</span> payload<span class="token punctuation">.</span>selectedCountry<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>When the callback to update <code>CountryStore</code> is registered, we save a reference
to the returned token. Using this token with <code>waitFor()</code>, we can guarantee
that <code>CountryStore</code> is updated before the callback that updates <code>CityStore</code>
needs to query its data.</p><div class="prism language-javascript">CityStore<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> flightDispatcher<span class="token punctuation">.</span><span class="token function">register<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>actionType <span class="token operator">===</span> <span class="token string">&#x27;country-update&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> // `CountryStore.country` may not be updated.
</span>    flightDispatcher<span class="token punctuation">.</span><span class="token function">waitFor<span class="token punctuation">(</span></span><span class="token punctuation">[</span>CountryStore<span class="token punctuation">.</span>dispatchToken<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // `CountryStore.country` is now guaranteed to be updated.
</span>
   <span class="token comment" spellcheck="true"> // Select the default city for the new country
</span>    CityStore<span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token function">getDefaultCityForCountry<span class="token punctuation">(</span></span>CountryStore<span class="token punctuation">.</span>country<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>The usage of <code>waitFor()</code> can be chained, for example:</p><div class="prism language-javascript">FlightPriceStore<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span>
  flightDispatcher<span class="token punctuation">.</span><span class="token function">register<span class="token punctuation">(</span></span><span class="token keyword">function</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    switch <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>actionType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      case <span class="token string">&#x27;country-update&#x27;</span><span class="token punctuation">:</span>
      case <span class="token string">&#x27;city-update&#x27;</span><span class="token punctuation">:</span>
        flightDispatcher<span class="token punctuation">.</span><span class="token function">waitFor<span class="token punctuation">(</span></span><span class="token punctuation">[</span>CityStore<span class="token punctuation">.</span>dispatchToken<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FlightPriceStore<span class="token punctuation">.</span>price <span class="token operator">=</span>
          <span class="token function">getFlightPriceStore<span class="token punctuation">(</span></span>CountryStore<span class="token punctuation">.</span>country<span class="token punctuation">,</span> CityStore<span class="token punctuation">.</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>The <code>country-update</code> payload will be guaranteed to invoke the stores&#x27;
registered callbacks in order: <code>CountryStore</code>, <code>CityStore</code>, then
<code>FlightPriceStore</code>.</p></div><div class="docs-prevnext"><a class="docs-next" href="flux-utils.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2014-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>